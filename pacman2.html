<link rel="stylesheet" href="style.css">

<div class="centrado">
  <canvas id="canvas" width="400" height="400" tabindex="1"></canvas>
</div>

<div class="centrado" style="height: 550px;"></div>

<!-- Botones -->
<div class="centrado">
  <a href="pacman0.html"><button class="botones" id="btnvolver" style="display: none;">Volver a jugar</button></a>
  <a href="menu.html"><button class="botones-atras" id="btnmenu" style="display: none;">Menu</button></a>
</div>

<!-- Contadores -->
<h2 id="puntos"></h2>
<h2 id="tiempo"></h2>

<script src="web-lib/processing.js"></script>
<script src="web-lib/functional-light.js"></script>
<script src="web-lib/buzz.min.js"></script>
<script>

  //Vamos a usar http://processingjs.org/
  // o https://p5js.org/reference/
  // Importamos las librerias
  let { append, cons, first, isEmpty, isList, length, rest, deepCopy, concat, forEach } = functionalLight;
  
  //Declaración de imagenes
      let barriles = null;
      let explosion1 = null;
      let explosion2 = null;
      let f1 = null;
      let f1_2 =null;
      let f2 = null;
      let f2_2 =null;
      let f3 = null;
      let f3_2 =null;
      let f4 = null;
      let f4_2 =null;
      let ff = null;
      let ff_2 =null;
      let fjosecito = null;
      let pacman1 = null;
      let pacman1_left = null;
      let pacman1_down = null;
      let pacman1_up =null;
      let pacman2 = null;
      let pacman2_left = null;
      let pacman2_down = null;
      let pacman2_up = null;
      let pacman3 = null;
      let pacman3_left = null;
      let pacman3_down = null;
      let pacman3_up = null;
      let pacman1Muerte = null;
      let pacman2Muerte = null;
      let pacman3Muerte = null;
      let pacman4Muerte = null;
      let pacman5Muerte = null;
      let vidaPacmanImg = null;
      let portal = null;
      let portal1_explosion = null;
      let portal2_explosion = null;
      let portal3_explosion = null;

 /**
   * Funcion para hacer una copia profunda de un objeto 
   * @param {Object} -> data
   * @param {Object} -> attribute
   * @returns {Object}
  */ 
  function make(data, attribute) {
    return Object.assign({}, data, attribute);
  }


  /**
   * Funcion para pintar el mapa
   * @param {*} -> processing
   * @param {array} -> mapa
   * @param {Object} -> world
   * @returns {*}
  */ 

  function createMap(processing, mapa, world){
    forEach(mapa, (row, i) => {
        forEach(row, (cell, j) => {
          if (cell == 0) {

            activo = true;
            processing.fill(0, 0, 0);
            processing.rect(j * SIZE, i * SIZE, SIZE, SIZE);
            processing.fill(57, 255, 20);
            processing.ellipse(j * SIZE + SIZE / 2, i * SIZE + SIZE / 2, SIZE / 3 , SIZE / 3 );

          } if(cell == 1) {

            processing.fill(0, 0, 200);
            processing.rect(j * SIZE, i * SIZE, SIZE, SIZE);

          } if (cell == 3) {

            processing.fill(0, 0, 0);

          } if (cell == 6) {

            processing.fill(0, 0, 0);
            if (world.time % 2 == 0)
              processing.image(portal, j * SIZE + 5 , i * SIZE + 5 , 40 , 40 );
            else
              processing.image(portal, j * SIZE + 7.5 , i * SIZE + 7.5 , 35 , 35 );

          } if(cell == 11){

            if(world.modoPortal){
              if(world.portalAnimacion >4) processing.image(portal1_explosion, j * SIZE + 5 , i * SIZE + 5 , 40 , 40 );
              if(world.portalAnimacion > 2) processing.image(portal2_explosion, j * SIZE + 5 , i * SIZE + 5 , 40 , 40 );
              if(world.portalAnimacion  > 0) processing.image(portal3_explosion, j * SIZE + 5 , i * SIZE + 5 , 40 , 40 ); 
            } else {
              Object.assign(deepCopy(mapa),mapa[i][j] = 12);
            }

          }  if(cell == 7) {

            processing.fill(0, 200, 200);
            if (world.time % 2 == 0)
              processing.image(barriles, j * SIZE, i * SIZE , 45, 45);
            else
              processing.image(barriles, j * SIZE, i * SIZE , 50, 50);

          } if(cell == 9) {

            processing.fill(0, 200, 200);

          } if(cell == 10) {

            processing.fill(0, 200, 200);

          } if(cell == 8){

            processing.fill(0, 200, 200);

          } if(cell == 15){

              if(world.modoBarril){
                if(world.barrilAnimacion == 2 ) processing.image(explosion2, j * SIZE - 10, i * SIZE - 10)
                if(world.barrilAnimacion == 4 ) processing.image(explosion1, j * SIZE - 10, i * SIZE - 10)
              } else {
                Object.assign(deepCopy(mapa),mapa[i][j] = 13);
              }

          } if(world.modoComer && world.comerFantasmas == 1 && cell == 11){

                  Object.assign(deepCopy(mapa),mapa[i][j] = 12);
                  
          }
        } );
      });


  }

  // Movimiento

   /**
   * Funcion que permite el movimiento del pacman y evaluar las colisiones para saber si el pacman se puede mover o no(Tambien se implementan los teletransportes)
   * @param {Object} -> world
   * @returns {Object}
  */ 

  function movimiento(world){
    const time1 = world.time;
    const animacion = world.pacmanAnimacion;
    if(world.pintPacman){


      if(teletransportarLEFT(world,world.pacman)) return {pacman:{pacmany: world.pacman.pacmany, y: world.pacman.y ,x: 1, pacmanx: 0 * SIZE }}
      if(teletransportarRIGHT(world,world.pacman)) return {pacman:{pacmany: world.pacman.pacmany, y: world.pacman.y, x: 23, pacmanx: 22 * SIZE }}
      if(world.ejex && world.xMove && (colisionRIGHT(world,world.pacman))) return { ejex:false, ejey: false };
      if(world.ejex && !world.xMove && (colisionLEFT(world,world.pacman))) return  {  ejex:false, ejey: false};
      if(world.ejey && world.yMove && (colisionUP(world, world.pacman))) return  {  ejex:false, ejey: false };
      if(world.ejey && !world.yMove && (colisionDOWN(world, world.pacman))) return {  ejex:false, ejey: false}; 

      if(world.ejex && world.xMove) return { pacman:{pacmanx: world.pacman.pacmanx + SIZE, pacmany: world.pacman.pacmany,  x: world.pacman.x + 1, y: world.pacman.y}};
      if(world.ejex && !world.xMove) return {pacman:{pacmanx: world.pacman.pacmanx - SIZE, pacmany: world.pacman.pacmany,  x: world.pacman.x - 1, y: world.pacman.y}};
      if(world.ejey && world.yMove) return { pacman:{pacmanx: world.pacman.pacmanx, pacmany: world.pacman.pacmany - SIZE,  x: world.pacman.x, y: world.pacman.y - 1}};
      if(world.ejey && !world.yMove) return {pacman:{pacmanx: world.pacman.pacmanx, pacmany: world.pacman.pacmany + SIZE,  x: world.pacman.x, y: world.pacman.y + 1}};
      if(!world.ejey && !world.ejex) return {time: time1 + 1, pacmanAnimacion: animacion + 1};

    } else {
      return {time: time1 + 1, pacmanAnimacion: animacion + 1, ejey: false, ejex: false};
    }
  }

  //PACMAN
  
  /**
   * Funcion que pinta el pacman con una animación
   * @param {*} -> processing
   * @param {Object} -> world
   * @returns {*}
  */ 
  
  function pintarPacman(processing,world){
    if(world.pintPacman){
      if (world.pacmanAnimacion == 1) {
        if (!world.ejey && !world.ejex) processing.image(pacman1, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && world.xMove) processing.image(pacman1, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && !world.xMove) processing.image(pacman1_left, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejey && world.yMove) processing.image(pacman1_up, world.pacman.pacmanx +5 , world.pacman.pacmany -5, 150 , 100);
        if (world.ejey && !world.yMove) processing.image(pacman1_down, world.pacman.pacmanx + 5 , world.pacman.pacmany - 5, 150 , 100);
      }

      if (world.pacmanAnimacion == 2) {
        if (!world.ejey && !world.ejex) processing.image(pacman2, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && world.xMove) processing.image(pacman2,  world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && !world.xMove) processing.image(pacman2_left, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejey && world.yMove) processing.image(pacman2_up, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejey && !world.yMove) processing.image(pacman2_down, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
      }
      if (world.pacmanAnimacion == 3) {
        if (!world.ejey && !world.ejex) processing.image(pacman3, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && world.xMove) processing.image(pacman3,  world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && !world.xMove) processing.image(pacman3_left, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejey && world.yMove) processing.image(pacman3_up, world.pacman.pacmanx , world.pacman.pacmany , 150 , 100);
        if (world.ejey && !world.yMove) processing.image(pacman3_down, world.pacman.pacmanx , world.pacman.pacmany , 150 , 100);
      }

      if (world.pacmanAnimacion == 4) {
        if (!world.ejey && !world.ejex) processing.image(pacman2, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && world.xMove) processing.image(pacman2,  world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejex && !world.xMove) processing.image(pacman2_left, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
        if (world.ejey && world.yMove) processing.image(pacman2_up, world.pacman.pacmanx , world.pacman.pacmany , 150 , 100);
        if (world.ejey && !world.yMove) processing.image(pacman2_down, world.pacman.pacmanx , world.pacman.pacmany , 150 , 100);
      }
   } else {
      if (world.gameOver > 10) processing.image(pacman1Muerte, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
      if (world.gameOver > 8) processing.image(pacman2Muerte, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
      if (world.gameOver > 6) processing.image(pacman3Muerte, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
      if (world.gameOver > 4) processing.image(pacman4Muerte, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
      if (world.gameOver > 2) processing.image(pacman5Muerte, world.pacman.pacmanx , world.pacman.pacmany, 150 , 100);
   }
  }
 
  /**
   * Funcion que anima el movimiento del pacman con respecto al tiempo
   * @param {Object} -> world
   * @returns {object}
  */ 
  function animacionPacman(world){
    if(world.pacmanAnimacion < 4) return {pacmanAnimacion: world.pacmanAnimacion + 1};
    return {pacmanAnimacion: 1};
  }

//VIDAS

 /**
   * Funcion que pinta inicialmente las vidas de pacman y las retira cuando el pacman las pierde
   * @param {*} -> processing
   * @param {Object} -> world
   * @returns {*}
  */ 

 function pintarVidasPacman(processing, world){
   //Condicionales para poner en pantalla las vidas al pacman
  if(world.vidaPacman == 4){
      if(world.pacmanAnimacion == 1){
        processing.image(vidaPacmanImg, 100  ,755,140,140);
        processing.image(vidaPacmanImg, 170 ,765,140,140);
        processing.image(vidaPacmanImg, 240,755,140,140);
      } 
      if (world.pacmanAnimacion == 2){
        processing.image(vidaPacmanImg, 100  ,760,140,140);
        processing.image(vidaPacmanImg, 170 ,760,140,140);
        processing.image(vidaPacmanImg, 240,760,140,140);
      }

      if (world.pacmanAnimacion == 3){
        processing.image(vidaPacmanImg, 100  ,765,140,140);
        processing.image(vidaPacmanImg, 170 ,755,140,140);
        processing.image(vidaPacmanImg, 240,765,140,140);
      }

      if (world.pacmanAnimacion == 4){
        processing.image(vidaPacmanImg, 100  ,760,140,140);
        processing.image(vidaPacmanImg, 170 ,760,140,140);
        processing.image(vidaPacmanImg, 240,760,140,140);
      }
    }
      
  if(world.vidaPacman == 3){
      if(world.pacmanAnimacion == 1){
        processing.image(vidaPacmanImg, 100  ,755,140,140);
        processing.image(vidaPacmanImg, 170 ,765,140,140);

      } 
      if (world.pacmanAnimacion == 2){
        processing.image(vidaPacmanImg, 100  ,760,140,140);
        processing.image(vidaPacmanImg, 170 ,760,140,140);

      }

      if (world.pacmanAnimacion == 3){
        processing.image(vidaPacmanImg, 100  ,765,140,140);
        processing.image(vidaPacmanImg, 170 ,755,140,140);

      }

      if (world.pacmanAnimacion == 4){
        processing.image(vidaPacmanImg, 100  ,760,140,140);
        processing.image(vidaPacmanImg, 170 ,760,140,140);

      }
    }
  if(world.vidaPacman == 2){
          if(world.pacmanAnimacion == 1){
            processing.image(vidaPacmanImg, 100  ,755,140,140);

          } 
          if (world.pacmanAnimacion == 2){
            processing.image(vidaPacmanImg, 100  ,760,140,140);

          }

          if (world.pacmanAnimacion == 3){
            processing.image(vidaPacmanImg, 100  ,765,140,140);

          }

          if (world.pacmanAnimacion == 4){
            processing.image(vidaPacmanImg, 100  ,760,140,140);

          }
    }
 }

 /**
   * Funcion que determina cuando pacman pierde una vida
   * @param {Object} -> world
   * @returns {Object}
  */ 
  function vidasPacman(world){
    if(!world.modoComer){
    if((world.f1.y == world.pacman.y) && (world.f1.x == world.pacman.x)){
      if(world.gameOver>0){
        return {gameOver: world.gameOver -1 , pintPacman: false};
      } else {
        return {pintPacman: true, gameOver: 12, vidaPacman: world.vidaPacman - 1, pacman:{pacmanx: 11 * SIZE, pacmany: 8.7 * SIZE, x: 12, y: 9}}
      }
      
    }
    if((world.f2.y == world.pacman.y) && (world.f2.x == world.pacman.x)){
      if(world.gameOver>0){
        return {gameOver: world.gameOver -1 , pintPacman: false};
      } else {
        return {pintPacman: true, gameOver: 12, vidaPacman: world.vidaPacman - 1, pacman:{pacmanx: 11 * SIZE, pacmany: 8.7 * SIZE,x: 12, y: 9}}
      }
    }
    if((world.f3.y == world.pacman.y) && (world.f3.x == world.pacman.x)){
      if(world.gameOver>0){
        return {gameOver: world.gameOver -1 , pintPacman: false};
      } else {
        return {pintPacman: true, gameOver: 12, vidaPacman: world.vidaPacman - 1, pacman:{pacmanx: 11 * SIZE, pacmany: 8.7 * SIZE, x: 12, y: 9}}
      }
    }
    if((world.f4.y == world.pacman.y) && (world.f4.x == world.pacman.x)){
      if(world.gameOver>0){
        return {gameOver: world.gameOver -1 , pintPacman: false};
      } else {
        return {pintPacman: true, gameOver: 12, vidaPacman: world.vidaPacman - 1, pacman:{pacmanx: 11 * SIZE, pacmany: 8.7 * SIZE, x: 12, y: 9}}
      }
    }
   }
  }



  //COMER
  
 /**
   * funcion que realiza una copia de la lista mapa y modifica uno de sus elementos
   * @param {*} -> processing
   * @param {Object} -> world
   * @param {array} -> mapa
   * @returns {array}
  */ 
  function comer(processing, world, mapa){
    if(mapa[world.pacman.y][world.pacman.x] == 0){
      Object.assign(deepCopy(mapa),mapa[world.pacman.y][world.pacman.x] = 2);
    }

    if(mapa[world.pacman.y][world.pacman.x] == 7){
      Object.assign(deepCopy(mapa),mapa[world.pacman.y][world.pacman.x] = 15);
    }

    if(mapa[world.pacman.y][world.pacman.x] == 6){
      Object.assign(deepCopy(mapa),mapa[world.pacman.y][world.pacman.x] = 11);
    }

    if(world.timeFantasmas == 60){
      Object.assign(deepCopy(mapa),mapa[6][12] = 1);
    }


  }


//EXPLOTAR
/**
   * Esta funcion permite animar la explocion de los barriles cuando el pacman pase sobre ellos
   * @param {Object} -> world
   * @returns {object}
  */ 

  function explotar(world){

    if(world.mapa[world.pacman.y][world.pacman.x]  == 15){
      return {modoBarril: true};
    }
    if(world.modoBarril){
      if(world.barrilAnimacion > 0) return {barrilAnimacion: world.barrilAnimacion - 1}
      return { barrilAnimacion:4, modoBarril: false};
    }


  }
  /**
   * Esta funcion permite animar como se rompen los portales cuando el pacman pase sobre ellos
   * @param {Object} -> world
   * @returns {object}
  */ 

  function portalAnimacionF(world){
    if(world.mapa[world.pacman.y][world.pacman.x]  == 11){
      return {modoPortal: true};
    }
    if(world.modoPortal){
      if(world.portalAnimacion > 0) return {portalAnimacion: world.portalAnimacion - 1}
      return { portalAnimacion:6, modoPortal: false};
    }
}

//PUNTOS
  /**
   * Funcion que acumula los puntos al comer fantasmas
   * @param {Object} -> world
   * @returns {object}
  */ 
  function puntosFantasmasF(world){
    if(world.pacman.x == world.f1.x && world.pacman.y == world.f1.y && world.modoComer){
        return {puntosFantasmas: world.puntosFantasmas + 200};
    } else if(world.pacman.x == world.f2.x && world.pacman.y == world.f2.y && world.modoComer){
        return {puntosFantasmas: world.puntosFantasmas + 200};
    }else if(world.pacman.x == world.f3.x && world.pacman.y == world.f3.y && world.modoComer){
        return {puntosFantasmas: world.puntosFantasmas + 200};
    }else if(world.pacman.x == world.f4.x && world.pacman.y == world.f4.y && world.modoComer){
        return {puntosFantasmas: world.puntosFantasmas + 200};
    }
  }
  /**
   * Funcion que acumula los puntos al comer galletas y barriles durante la partida 
   * @param {Object} -> world
   * @param {list} -> list
   * @param {number} -> accum
   * @returns {number}
  */ 
  function acumularPuntos(list, accum, world){
    if(isEmpty(list)) {return accum;}
    if((first(list)) == 2){
        return acumularPuntos(rest(list), accum + 10, world) 
    } else if(first(list) == 15){
        return acumularPuntos(rest(list), accum + 500, world) 
    } else if(first(list) == 13){
        return acumularPuntos(rest(list), accum + 500, world) 
    } else  {
        return acumularPuntos(rest(list), accum, world );
    }
  }
 
  /**
   * Funcion que acumula los puntos al comer galletas, barriles y fantasmas durante la partida 
   * @param {array} -> list
   * @param {number} -> accum
   * @param {Object} -> world 
   * @returns {number}
  */ 
  function acumuladoTotal(list, accum, world){
    if(isEmpty(list)) return accum + world.puntosFantasmas;
    return acumularPuntos(first(list),accum,world) + acumuladoTotal(rest(list),accum,world);
  }

  /**
   * Funcion que determina el total de ceros que hay en una lista
   * @param {array} -> list
   * @param {number} -> accum
   * @param {Object} -> world 
   * @returns {number}
  */ 
  function ganar(list, accum, world){
      if(isEmpty(list)) {return accum;}
      if((first(list)) == 0){
          return ganar(rest(list), accum + 1, world); 
      } else  {
          return ganar(rest(list), accum, world );
      }
  }
  
  /**
   * Funcion que determina el total de ceros que hay en una lista de listas
   * @param {array} -> list
   * @param {number} -> accum
   * @param {Object} -> world 
   * @returns {number}
  */ 

  function acumuladoTotalGanar(list, accum, world){
    if(isEmpty(list)) return accum;
    return ganar(first(list),accum,world) + acumuladoTotalGanar(rest(list),accum,world);
  }


//COLISIONES

  /**
   *Determina si la posicion de arriba del pacman es una pared
   * @param {Object} -> world
   * @param {Object} -> pos
   * @returns {boolean}
  */ 
  function colisionUP(world,pos){
    if(world.mapa[pos.y - 1][pos.x] == 1) return true;
    return false;
  }
  /**
   *Determina si la posicion de abajo del pacman es una pared
   * @param {Object} -> world
   * @param {Object} -> pos
   * @returns {boolean}
  */ 
  function colisionDOWN(world, pos){
    if(world.mapa[pos.y + 1][pos.x] == 1) return true;
    return false;
  }
  /**
   * Determina si la posicion de la derecha del pacman es una pared
   * @param {Object} -> world
   * @param {Object} -> pos
   * @returns {boolean}
  */ 
  function colisionRIGHT(world, pos){
    if(world.mapa[pos.y][pos.x + 1] == 1) return true;
    return false;
  }
  /**
   * Determina si la posicion de la izquierda del pacman es una pared
   * @param {Object} -> world
   * @param {Object} -> pos
   * @returns {boolean}
  */ 
  function colisionLEFT(world, pos){
    if(world.mapa[pos.y][pos.x - 1] == 1) return true;
    return false;
  }
  /**
   * Determina si la posicion de la derecha del pacman es un teletransporte
   * @param {Object} -> world
   * @param {Object} -> pos
   * @returns {boolean}
  */ 
  function teletransportarRIGHT(world, pos){
    if(world.mapa[pos.y][pos.x] == 4 ) return true;
    return false;
  }
 /**
   *Determina si la posicion de la Izquierda del pacman es un teletransporte
   * @param {Object} -> world
   * @param {Object} -> pos
   * @returns {boolean}
  */ 
  function teletransportarLEFT(world, pos){
    if(world.mapa[pos.y][pos.x] == 10 ) return true;
    return false;
  }


  //FANTASMAS

  /**
   * Funcion que pinta los fantasmas con una animación
   * @param {*} -> processing
   * @param {Object} -> world
   * @returns {*}
  */ 
  function pintarFantasmas(processing,world){
    if(world.modoComer && world.pintPacman){
      if (world.time % 2 == 0)
        processing.image(ff, world.f1.fantx  + 5, world.f1.fanty, 43, 43);
      else 
        processing.image(ff_2, world.f1.fantx + 5 , world.f1.fanty, 43, 43);

      if (world.time % 2 == 0)
        processing.image(ff, world.f2.fantx + 5, world.f2.fanty, 43, 43);
      else 
        processing.image(ff_2, world.f2.fantx + 5 , world.f2.fanty, 43, 43);

      if (world.time % 2 == 0)
        processing.image(ff, world.f3.fantx + 5 , world.f3.fanty, 43, 43);
      else 
        processing.image(ff_2, world.f3.fantx  + 5, world.f3.fanty, 43, 43);

      if (world.time % 2 == 0)
        processing.image(ff, world.f4.fantx + 5 , world.f4.fanty, 43, 43);
      else 
        processing.image(ff_2, world.f4.fantx + 5 , world.f4.fanty, 43, 43);

    } else if(world.pintPacman) {

      if (world.time % 2 == 0)
        processing.image(f1, world.f1.fantx , world.f1.fanty, 47, 47);
      else 
        processing.image(f1_2, world.f1.fantx , world.f1.fanty, 47, 47);

      if (world.time % 2 == 0)
        processing.image(f2, world.f2.fantx, world.f2.fanty, 50, 50);
      else 
        processing.image(f2_2, world.f2.fantx , world.f2.fanty, 50, 50);

      if (world.time % 2 == 0)
        processing.image(f3, world.f3.fantx , world.f3.fanty, 50, 50);
      else 
        processing.image(f3_2, world.f3.fantx , world.f3.fanty, 50, 50);

      if (world.time % 2 == 0)
        processing.image(f4, world.f4.fantx , world.f4.fanty, 50, 50);
      else 
        processing.image(f4_2, world.f4.fantx , world.f4.fanty, 50, 50);
    }



  }

//MOVIMIENTO FANTASMAS

/**
 * Funcion para saber la distancia euclidiana entre dos puntos
 * @param{number}->x1
 * @param{number}->y1
 * @param{number}->x2
 * @param{number}->y2
 * @return {number}
 * @example: distanciaEuclidiana(1,1,2,2)//-> Math.sqrt(2)
 */

function distanciaEuclidiana(x1,y1,x2,y2){
  return Math.sqrt((Math.pow((x2-x1),2))+(Math.pow((y2-y1),2)));
}

/**
 * Funcion para marcar el tiempo en el que los fantasmas salen de la jaula al iniciar la partida
 * @param{Object}-> world
 * @return{Object}
 */
function inicioFantasmasTime(world){
  if(world.pintPacman && (world.timeFantasmas > 0)){
    return {timeFantasmas: world.timeFantasmas -1};
  } else if(!world.pintPacman){
    return {timeFantasmas: 60};
  }
}


/**
 * Funcion para ir sacando los fantasmas de la jaula al iniciar la partida
 * @param{Object}->world
 * @return{Object}
 */
function inicioFantasmas(world){
  if(world.timeFantasmas == 50) return {f2: { fantx: 12 * SIZE + 2, fanty: 5 * SIZE + 2 , x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
  if(world.timeFantasmas == 30) return {f3: { fantx: 12 * SIZE + 2, fanty: 5 * SIZE + 2 , x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
  if(world.timeFantasmas == 10) return {f4: { fantx: 12 * SIZE + 2, fanty: 5 * SIZE + 2 , x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
  if(world.timeFantasmas == 1) return {f1: { fantx: 12 * SIZE + 2, fanty: 5 * SIZE + 2 , x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
}

/**
 * Funcion que permite a los fantasmas utilizar el teletransporte que hay en el mapa
 * @param{Object}-> world
 * @return{Object}
 */
function teletransporteFantasmas(world){
  if(teletransportarLEFT(world,world.f1)){
    return {f1:{fantx: 1 * SIZE + 2, fanty: world.f1.fanty, x: 1, y: world.f1.y, xa: world.f1.x, ya: world.f1.y, dir: "none"}};
  }

  if(teletransportarRIGHT(world,world.f1)){
    return {f1:{fantx: 23 * SIZE + 2, fanty: world.f1.fanty, x: 23, y: world.f1.y, xa: world.f1.x, ya: world.f1.y, dir: "none"}};
  }

  if(teletransportarLEFT(world,world.f2)){
    return {f2:{fantx: 1 * SIZE + 2, fanty: world.f2.fanty, x: 1, y: world.f2.y, xa: world.f2.x, ya: world.f2.y, dir: "none"}};
  }

  if(teletransportarRIGHT(world,world.f2)){
    return {f2:{fantx: 23 * SIZE + 2, fanty: world.f2.fanty, x: 23, y: world.f2.y, xa: world.f2.x, ya: world.f2.y, dir: "none"}};
  }

  if(teletransportarLEFT(world,world.f3)){
    return {f3:{fantx: 1 * SIZE + 2, fanty: world.f3.fanty, x: 1, y: world.f3.y, xa: world.f3.x, ya: world.f3.y, dir: "none"}};
  }

  if(teletransportarRIGHT(world,world.f3)){
    return {f3:{fantx: 23 * SIZE + 2, fanty: world.f3.fanty, x: 23, y: world.f3.y, xa: world.f3.x, ya: world.f3.y, dir: "none"}};
  }

  if(teletransportarLEFT(world,world.f4)){
    return {f4:{fantx: 1 * SIZE + 2, fanty: world.f4.fanty, x: 1, y: world.f4.y, xa: world.f4.x, ya: world.f4.y, dir: "none"}};
  }

  if(teletransportarRIGHT(world,world.f4)){
    return {f4:{fantx: 23 * SIZE + 2, fanty: world.f4.fanty, x: 23, y: world.f4.y, xa: world.f4.x, ya: world.f4.y, dir: "none"}};
  }
}

  /**
   * Esta función genera el movimiento de los fantasmas calculando la distancia euclidiana que hay entre ellos y el pacman (dependiendo del estado o de la dificultad, los fantasmas se van a acercar o alejar del pacman).
   * @param {Object} -> world
   * @param {*} -> processing
   * @returns {Object}
  */ 


function fantasmasIA(world,fantasma,pacmancito){
  let random = Math.round(Math.random() * (3 - 0)) + 0;
  const disUP = distanciaEuclidiana(fantasma.x,fantasma.y - 1, pacmancito.x + random , pacmancito.y + random );
  const disDOWN = distanciaEuclidiana(fantasma.x,fantasma.y + 1, pacmancito.x - random , pacmancito.y - random);
  const disRIGHT = distanciaEuclidiana(fantasma.x + 1 ,fantasma.y, pacmancito.x + random, pacmancito.y - random);
  const disLEFT = distanciaEuclidiana(fantasma.x - 1,fantasma.y, pacmancito.x, pacmancito.y);

 if(!world.modoComer){ 
  if(world.pintPacman){

    if(world.time%2 == 0){

    if(!colisionUP(world,fantasma) && disUP == Math.min(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.y-1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};

        } else if(!colisionDOWN(world,fantasma) && disDOWN == Math.min(disDOWN,disRIGHT,disLEFT) && (fantasma.y+1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};

        } else if(!colisionRIGHT(world,fantasma) && disRIGHT == Math.min(disRIGHT,disLEFT) && (fantasma.x+1 !== fantasma.xa)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};

        } else if(!colisionLEFT(world,fantasma) && (fantasma.x-1 !== fantasma.xa)) {
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        }

//--------------------------------------------------------------------------------------------------------------------------------------------

    if(!colisionDOWN(world,fantasma) && disDOWN == Math.min(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.y+1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        } else if(!colisionUP(world,fantasma) && disUP == Math.min(disUP,disRIGHT,disLEFT) && (fantasma.y-1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        } else if(!colisionRIGHT(world,fantasma) && disRIGHT == Math.min(disRIGHT,disLEFT) && (fantasma.x+1 !== fantasma.xa)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        } else if(!colisionLEFT(world,fantasma) && (fantasma.x-1 !== fantasma.xa)) {
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        }

//--------------------------------------------------------------------------------------------------------------------------------------------

        if(!colisionRIGHT(world,fantasma) && disRIGHT == Math.min(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.x+1 !== fantasma.xa)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        } else if(!colisionUP(world,fantasma) && disUP == Math.min(disUP,disDOWN,disLEFT) && (fantasma.y-1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        } else if(!colisionDOWN(world,fantasma) && disDOWN == Math.min(disDOWN,disLEFT) && (fantasma.y+1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};

        } else if(!colisionLEFT(world,fantasma) && (fantasma.x-1 !== fantasma.xa)) {
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
    }


    //--------------------------------------------------------------------------------------------------------------------------------------------

    if(!colisionLEFT(world,fantasma) && disLEFT == Math.min(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.x-1 !== fantasma.xa)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
          
        } else if(!colisionUP(world,fantasma) && disUP == Math.min(disUP,disDOWN,disRIGHT) && (fantasma.y-1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};

        } else if(!colisionDOWN(world,fantasma) && disDOWN == Math.min(disDOWN,disRIGHT) && (fantasma.y+1 !== fantasma.ya)){
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};

        } else if(!colisionRIGHT(world,fantasma) && (fantasma.x+1 !== fantasma.xa)) {
          if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
          if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
    }
    
  }
  } else if(!world.pintPacman && world.gameOver>0) {
    if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty  , x: world.pacman.x , y: world.pacman.y, xa: fantasma.x, ya: fantasma.y, dir: "none"}};
    if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty  , x: world.pacman.x , y: world.pacman.y, xa: fantasma.x, ya: fantasma.y, dir: "none"}};
    if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty  , x: world.pacman.x , y: world.pacman.y, xa: fantasma.x, ya: fantasma.y, dir: "none"}};
    if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty  , x: world.pacman.x , y: world.pacman.y, xa: fantasma.x, ya: fantasma.y, dir: "none"}};
  } else {
    if(fantasma == world.f1) return {f1:{fantx: 13 * SIZE + 2, fanty: 7 * SIZE + 2 , x: 13, y: 7, xa: 0, ya: 0, dir: "none"}};
    if(fantasma == world.f2) return {f2:{fantx: 12 * SIZE,     fanty: 6 * SIZE,      x: 12, y: 6, xa: 0, ya: 0, dir: "none"}};
    if(fantasma == world.f3) return {f3:{fantx: 12 * SIZE,     fanty: 7 * SIZE,      x: 12, y: 7, xa: 0, ya: 0, dir: "none"}};
    if(fantasma == world.f4) return {f4:{fantx: 11 * SIZE,     fanty: 7 * SIZE,      x: 11, y: 7, xa: 0, ya: 0, dir: "none"}};
  }
} else {
  if(pacmancito.x !== fantasma.x && pacmancito.y !== fantasma.y){

  if(world.time%2 == 0){

  if(!colisionUP(world,fantasma) && disUP == Math.max(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.y-1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};

      } else if(!colisionDOWN(world,fantasma) && disDOWN == Math.max(disDOWN,disRIGHT,disLEFT) && (fantasma.y+1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};

      } else if(!colisionRIGHT(world,fantasma) && disRIGHT == Math.max(disRIGHT,disLEFT) && (fantasma.x+1 !== fantasma.xa)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};

      } else if(!colisionLEFT(world,fantasma) && (fantasma.x-1 !== fantasma.xa)) {
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
      }

  //--------------------------------------------------------------------------------------------------------------------------------------------

  if(!colisionDOWN(world,fantasma) && disDOWN == Math.max(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.y+1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty + SIZE  , x: fantasma.x, y: fantasma.y + 1, xa: fantasma.x, ya: fantasma.y, dir: "down"}};
      } else if(!colisionUP(world,fantasma) && disUP == Math.max(disUP,disRIGHT,disLEFT) && (fantasma.y-1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
      } else if(!colisionRIGHT(world,fantasma) && disRIGHT == Math.max(disRIGHT,disLEFT) && (fantasma.x+1 !== fantasma.xa)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
      } else if(!colisionLEFT(world,fantasma) && (fantasma.x-1 !== fantasma.xa)) {
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
      }

  //--------------------------------------------------------------------------------------------------------------------------------------------

      if(!colisionRIGHT(world,fantasma) && disRIGHT == Math.max(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.x+1 !== fantasma.xa)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty  , x: fantasma.x + 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "right"}};
      } else if(!colisionUP(world,fantasma) && disUP == Math.max(disUP,disDOWN,disLEFT) && (fantasma.y-1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE   , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
      } else if(!colisionDOWN(world,fantasma) && disDOWN == Math.max(disDOWN,disLEFT) && (fantasma.y+1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE    , x: fantasma.x , y: fantasma.y +1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};

      } else if(!colisionLEFT(world,fantasma) && (fantasma.x-1 !== fantasma.xa)) {
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "left"}};
  }


  //--------------------------------------------------------------------------------------------------------------------------------------------

  if(!colisionLEFT(world,fantasma) && disLEFT == Math.max(disUP,disDOWN,disRIGHT,disLEFT) && (fantasma.x-1 !== fantasma.xa)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx - SIZE, fanty: fantasma.fanty   , x: fantasma.x - 1, y: fantasma.y, xa: fantasma.x, ya: fantasma.y, dir: "left"}};
        
      } else if(!colisionUP(world,fantasma) && disUP == Math.max(disUP,disDOWN,disRIGHT) && (fantasma.y-1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx, fanty: fantasma.fanty - SIZE  , x: fantasma.x, y: fantasma.y - 1, xa: fantasma.x, ya: fantasma.y, dir: "up"}};

      } else if(!colisionDOWN(world,fantasma) && disDOWN == Math.max(disDOWN,disRIGHT) && (fantasma.y+1 !== fantasma.ya)){
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx , fanty: fantasma.fanty + SIZE   , x: fantasma.x , y: fantasma.y + 1 , xa: fantasma.x, ya: fantasma.y, dir: "down"}};

      } else if(!colisionRIGHT(world,fantasma) && (fantasma.x+1 !== fantasma.xa)) {
        if(fantasma == world.f1) return {f1:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f2) return {f2:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f3) return {f3:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
        if(fantasma == world.f4) return {f4:{fantx: fantasma.fantx + SIZE, fanty: fantasma.fanty   , x: fantasma.x + 1, y: fantasma.y , xa: fantasma.x, ya: fantasma.y, dir: "right"}};
  }

  }
  } else if(pacmancito.x == world.f1.x && pacmancito.y == world.f1.y) {
  return  {f1:{fantx: 12 * SIZE + 2, fanty: 5 * SIZE + 2 , x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
} else if(pacmancito.x == world.f2.x && pacmancito.y == world.f2.y) {
  return {f2:{fantx: 12 * SIZE,     fanty: 5 * SIZE,      x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
} else if(pacmancito.x == world.f3.x && pacmancito.y == world.f3.y) {
  return {f3:{fantx: 12 * SIZE,     fanty: 5 * SIZE,      x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
} else if(pacmancito.x == world.f4.x && pacmancito.y == world.f4.y) {
  return {f4:{fantx: 12 * SIZE,     fanty: 5 * SIZE,      x: 12, y: 5, xa: 0, ya: 0, dir: "none"}};
}
}
}
  
  /**
   * Funcion que sirve para desactivar la habilidad de pacman de comer fantasmas
   * @param{Object}-> world
   * @return{Object}
   */
  function comerFantasmasF(world){
    if(world.modoComer){
      if(world.comerFantasmas <= 30 && world.comerFantasmas>1){
        return {comerFantasmas: world.comerFantasmas - 1};
      } else {
        return {modoComer: false, comerFantasmas: 30};
      }
    }
  }
  

  /**
   * Funcion utilizada para activar la habilidad de pacman para comer fantasmas
   * @param{Object}->world
   * @return{object}
   */
  function modoComerFantasmas(world){
    if(world.mapa[world.pacman.y][world.pacman.x] == 11){
      return {modoComer: true};
    }
  }



  //TIEMPO
  /**
   * Funcion para saber cuanto tiempo lleva el jugador en la partida
   * @param{Object}-> world
   * @return{number}
   */
  function tiempoReal(world){
    if(world.time%6 == 0) return {time_real: world.time_real + 1};
  }

  //GameOver
  
   /**
    * Funcion para finalizar la partida generando una pantalla u otra. Es de victoria si el jugador consigue todos los puntos del mapa, o de derrota si el pacman pierde todas las vidas.
    * @param {*}-> processing
    * @param {Object}-> world
    * @return {Object}
    */

  function gameOverF(processing,world){
    if(world.vidaPacman == 0){

      processing.noLoop();
      processing.fill(255,255,255);
      processing.textSize(255);
      processing.image(fjosecito, 350, 100);
      processing.text("Game ova", 200,700);
      document.getElementById("btnvolver").style.display = "inline";
      document.getElementById("btnmenu").style.display = "inline";

    }
    if(acumuladoTotalGanar(world.mapa, 0, world) == 0){
      processing.noLoop();
      processing.fill(255,255,255);
      processing.textSize(150);
      processing.text("¡GANASTE!", 380,400);
      document.getElementById("btnvolver").style.display = "inline";
      document.getElementById("btnmenu").style.display = "inline";

    }
  }

  //Dimensiones del juego
  const WIDTH = 1250;
  const HEIGHT = 900;
  //Tamaño de cada segmento del mundo
  const SIZE = 50; 

  function sketchProc(processing) {
    /**
     * Esto se llama antes de iniciar el juego
     */
    processing.setup = function () {
      processing.frameRate(6);
      processing.size(WIDTH, HEIGHT);

      //Imágenes del juego
      barriles = processing.loadImage('images/barriles2.2.png');
      explosion1 = processing.loadImage('images/explosion1.png');
      explosion2 = processing.loadImage('images/explosion2.png');
      f1 = processing.loadImage('images/f1.png');
      f1_2 = processing.loadImage('images/f1-2.png');
      f2 = processing.loadImage('images/f2.png');
      f2_2 = processing.loadImage('images/f2-2.png');
      f3 = processing.loadImage('images/f3.png');
      f3_2 = processing.loadImage('images/f3-2.png');
      f4 = processing.loadImage('images/f4.png');
      f4_2 = processing.loadImage('images/f4-2.png');
      ff = processing.loadImage('images/ff.png');
      ff_2 = processing.loadImage('images/ff-2.png');
      fjosecito = processing.loadImage('images/fjosecito.png');
      pacman1 = processing.loadImage('images/pacman1.png');
      pacman1_left = processing.loadImage('images/pacman1_left.png');
      pacman1_down = processing.loadImage('images/pacman1_down.png');
      pacman1_up = processing.loadImage('images/pacman1_up.png');
      pacman2 = processing.loadImage('images/pacman2.png');
      pacman2_left = processing.loadImage('images/pacman2_left.png');
      pacman2_down = processing.loadImage('images/pacman2_down.png');
      pacman2_up = processing.loadImage('images/pacman2_up.png');
      pacman3 = processing.loadImage('images/pacman3.png');
      pacman3_left = processing.loadImage('images/pacman3_left.png');
      pacman3_down = processing.loadImage('images/pacman3_down.png');
      pacman3_up = processing.loadImage('images/pacman3_up.png');
      pacman1Muerte = processing.loadImage('images/muerte/pacman1Muerte.png');
      pacman2Muerte = processing.loadImage('images/muerte/pacman2Muerte.png');
      pacman3Muerte = processing.loadImage('images/muerte/pacman3Muerte.png');
      pacman4Muerte = processing.loadImage('images/muerte/pacman4Muerte.png');
      pacman5Muerte = processing.loadImage('images/muerte/pacman5Muerte.png');
      vidaPacmanImg = processing.loadImage('images/vidaPacman.png');
      portal = processing.loadImage("images/portal.gif");
      portal1_explosion = processing.loadImage('images/portal1-explosion.png');
      portal2_explosion = processing.loadImage('images/portal2-explosion.png');
      portal3_explosion = processing.loadImage('images/portal3-explosion.png');

      //Fuente del texto 
      MyFont = processing.createFont("font1");
      
      
      processing.state = { 
        //Mapa del juego
        mapa: [[5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5],
              [5,5,5,1,0,0,0,0,0,0,0,7,1,7,0,0,0,0,0,0,0,1,5,5,5],
              [1,1,1,1,0,6,1,0,0,0,0,0,1,0,0,0,0,0,1,6,0,1,1,1,1],
              [1,7,0,0,0,1,1,0,1,1,0,0,6,0,0,1,1,0,1,1,0,0,0,7,1],
              [1,0,0,0,0,0,0,0,1,0,0,1,1,1,0,0,1,0,0,0,0,0,0,0,1],
              [1,0,1,0,1,0,1,0,1,0,0,0,7,0,0,0,1,0,1,0,1,0,1,0,1],
              [4,0,1,0,1,0,1,0,0,0,1,1,19,1,1,0,0,0,1,0,1,0,1,0,10],
              [4,0,0,0,0,0,0,7,1,0,1,9,9,9,1,0,1,7,0,0,0,0,0,0,10],
              [4,0,1,1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,0,1,1,0,10],
              [1,0,1,1,0,1,1,0,0,0,0,0,8,0,0,0,0,0,1,1,0,1,1,0,1],
              [1,0,1,7,0,0,1,0,1,0,0,1,1,1,0,0,1,0,1,0,0,7,1,0,1],
              [1,0,0,0,1,0,0,0,1,0,0,0,6,0,0,0,1,0,0,0,1,0,0,0,1],
              [1,1,1,1,6,0,1,0,1,1,1,0,1,0,1,1,1,0,1,0,6,1,1,1,1],
              [5,5,5,1,0,0,0,0,0,0,0,7,1,7,0,0,0,0,0,0,0,1,5,5,5],
              [5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5]],
        //Estados      
        time: 0,
        time_real: 0,
        puntos: 0,
        vidaPacman: 4,
        gameOver: 12,
        pintPacman: true,
        pacman: {pacmanx: 11 * SIZE, pacmany: 8.7 * SIZE, x: 12, y: 9},
        pacmanAnimacion: 1,
        modoComer: false,
        comerFantasmas: 30,
        modoBarril: false,
        barrilAnimacion: 4,
        modoPortal: false,
        portalAnimacion: 6,
        comerPacman : false,
        f1: { fantx: 13 * SIZE + 2, fanty: 7 * SIZE + 2 , x: 13, y: 7, xa: 0, ya: 0, dir: "none"},
        f2: { fantx: 12 * SIZE,     fanty: 6 * SIZE,      x: 12, y: 6, xa: 0, ya: 0, dir: "none"},
        f3: { fantx: 12 * SIZE,     fanty: 7 * SIZE,      x: 12, y: 7, xa: 0, ya: 0, dir: "none"},
        f4: { fantx: 11 * SIZE,     fanty: 7 * SIZE,      x: 11, y: 7, xa: 0, ya: 0, dir: "none"},
        timeFantasmas: 60,
        puntosFantasmas: 0,
        ejex: false,
        ejey: false,
        xMove: true,
        yMove: true,
        sonidoJuego: new buzz.sound("sounds/2.mp3"),            //Sonido ambiente
        sonidoVidrio: new buzz.sound("sounds/vidrio.mp3"),      //Sonido de los fragmentos del portal
        sonidoImpacto: new buzz.sound("sounds/impacto.mp3")     //Sonido de la explosion de los barriles

      };
    }
    // Dibuja algo en el canvas. Aqui se pone todo lo que quieras pintar

    processing.drawGame = function (world) {
      processing.background(0, 0, 0);

      //Crear el mapa

      createMap(processing,world.mapa,world);

      //Comer

      comer(processing,world, world.mapa);
    
      //Fantasmas

      pintarFantasmas(processing,world);

      // GUI

      processing.textFont(MyFont);
      processing.fill(255,255,255);
      processing.textSize(80);
      processing.text("PUNTOS : " + acumuladoTotal(world.mapa,0,world),800,870) ;
      processing.text("TIEMPO : " + world.time_real,800,820);
      pintarVidasPacman(processing,world);

      //Sonidos

      if(world.modoComer == true && world.comerFantasmas > 25){
        world.sonidoVidrio.play();
      }

      if(world.modoBarril == true){
        world.sonidoImpacto.play();
      }

      world.sonidoJuego.play();

      if (!buzz.isSupported()) {
        alert("Your browser is too old, time to update!");
      }

      //PACMAN

      pintarPacman(processing,world);

      //GAME OVER

      gameOverF(processing,world);
      
    }


    processing.onTic = function (world) {

      //Retorna todos los eventos del mundo por tic

       return make(world, Object.assign(movimiento(world), { time: world.time + 1}, tiempoReal(world),animacionPacman(world),explotar(world), modoComerFantasmas(world), comerFantasmasF(world), vidasPacman(world),portalAnimacionF(world)
       ,fantasmasIA(world,world.f1,world.pacman), fantasmasIA(world,world.f2,world.pacman), fantasmasIA(world,world.f3,world.pacman), fantasmasIA(world,world.f4,world.pacman),teletransporteFantasmas(world), inicioFantasmas(world), inicioFantasmasTime(world),
       puntosFantasmasF(world), ganar(world.mapa, 0, world)));
    }

    processing.onKeyEvent = function (world, keyCode) {
      switch (keyCode) {
         //Determina la dirección del pacman
        case processing.UP:
          return make(world, { ejex:false, ejey: true, yMove: true });
          break;
        case processing.DOWN:
          return make(world, { ejex:false, ejey: true, yMove: false });
          break;
        case processing.LEFT:
          return make(world, { ejex: true, ejey: false, xMove: false });
          break;
        case processing.RIGHT:
          return make(world, { ejex: true, ejey: false, xMove: true });
          break;
      }
    }

    processing.onMouseEvent = function (world, event) {
      return make(world, {});
    }

    // ******************** De aquí hacia abajo no debe cambiar nada. ********************

    // Esta es la función que pinta todo. Se ejecuta 60 veces por segundo. 
    // No cambie esta función. Su código debe ir en drawGame
    processing.draw = function () {
      processing.drawGame(processing.state);
      processing.state = processing.onTic(processing.state);
    };

    // Esta función se ejecuta cada vez que presionamos una tecla. 
    // No cambie esta función. Su código debe ir en onKeyEvent
    processing.keyPressed = function () {
      processing.state = processing.onKeyEvent(processing.state, processing.keyCode);
    }

    // Esta función se ejecuta cada vez movemos el mouse. 
    // No cambie esta función. Su código debe ir en onKeyEvent
    processing.mouseMoved = function () {
      processing.state = processing.onMouseEvent(processing.state,
        { action: "move", mouseX: processing.mouseX, mouseY: processing.mouseY });
    }

    // Estas funciones controlan los eventos del mouse. 
    // No cambie estas funciones. Su código debe ir en OnMouseEvent
    processing.mouseClicked = function () {
      processing.state = processing.onMouseEvent(processing.state,
        { action: "click", mouseX: processing.mouseX, mouseY: processing.mouseY, mouseButton: processing.mouseButton });
    }

    processing.mouseDragged = function () {
      processing.state = processing.onMouseEvent(processing.state,
        { action: "drag", mouseX: processing.mouseX, mouseY: processing.mouseY, mouseButton: processing.mouseButton });
    }

    processing.mousePressed = function () {
      processing.state = processing.onMouseEvent(processing.state,
        { action: "press", mouseX: processing.mouseX, mouseY: processing.mouseY, mouseButton: processing.mouseButton });
    }

    processing.mouseReleased = function () {
      processing.state = processing.onMouseEvent(processing.state,
        { action: "release", mouseX: processing.mouseX, mouseY: processing.mouseY, mouseButton: processing.mouseButton });
    }
    // Fin de los eventos del mouse
  }
  var canvas = document.getElementById("canvas");
  document.getElementById("canvas").focus();
  // Adjuntamos nuestro sketch al framework de processing
  var processingInstance = new Processing(canvas, sketchProc);
</script>



